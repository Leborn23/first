<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>祝福 SJL · 手机版一键开启</title>
  <style>
    :root{ --brand:#e91e63; }
    html,body{height:100%}
    body{
      margin:0; padding: calc(20px + env(safe-area-inset-top)) 20px calc(16px + env(safe-area-inset-bottom)) 20px; min-height: 100dvh; text-align:center; color:#222; -webkit-tap-highlight-color: transparent;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, KaiTi, "楷体", "Noto Serif SC", "Source Han Serif SC", serif;
      background: linear-gradient(120deg,#ffe1e7,#fff2cc,#d8e8ff,#e9d7ff,#ffe9d6,#e3f9e5);
      background-size: 400% 400%; animation:bgShift 22s ease infinite;
      position:relative; overflow:hidden;
    }
    @keyframes bgShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

    /* 柔焦彩球（移动端缩小、降模糊提性能） */
    .blob{position:absolute; border-radius:50%; filter:blur(14px); opacity:.28; pointer-events:none}
    .b1{width:24vw;height:24vw;left:6vw;top:10vh;background:#ff9abb}
    .b2{width:28vw;height:28vw;right:8vw;top:12vh;background:#9ad1ff}
    .b3{width:20vw;height:20vw;left:10vw;bottom:12vh;background:#ffd29a}
    .b4{width:30vw;height:30vw;right:8vw;bottom:8vh;background:#c7ffb0}

    h1{color:var(--brand); font-size:clamp(18px,5.5vw,28px); margin:4vh 0 3vh; text-shadow:0 2px 10px rgba(233,30,99,.15)}
    #startBtn{
      background:var(--brand); color:#fff; border:0; border-radius:999px; cursor:pointer; user-select:none;
      padding:14px 28px; font-size:clamp(16px,4.8vw,20px); letter-spacing:1px; outline:none;
      box-shadow:0 10px 24px rgba(233,30,99,.28); transition:transform .15s ease, box-shadow .2s ease, opacity .2s ease;
    }
    #startBtn:active{transform:scale(.98)}
    #startBtn[disabled]{opacity:.7}

    /* 祝福卡片（自适应尺寸） */
    .blessing-popup{
      position:fixed; left:0; top:0; width:clamp(160px, 45vw, 240px); height:clamp(80px, 22vw, 110px);
      display:flex; align-items:center; justify-content:center; text-align:center; padding:10px;
      border-radius:16px; color:#2a2a2a; box-shadow:0 10px 26px rgba(0,0,0,.18); pointer-events:none;
      font-size:clamp(14px,4.2vw,18px); line-height:1.25; opacity:0; transform:scale(.9); animation:pop .28s ease-out forwards;
      will-change: transform, opacity;
    }
    @keyframes pop{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}

    /* 飘落弹幕（减少阴影提性能） */
    .falling{position:fixed; left:0; top:-40px; white-space:nowrap; font-size:clamp(12px,3.8vw,18px); pointer-events:none; animation:fall linear forwards}
    @keyframes fall{from{transform:translateY(-60px)}to{transform:translateY(110vh)}}

    /* 降低动效支持 */
    @media (prefers-reduced-motion: reduce){
      body{animation:none}
      .blessing-popup{animation:none; opacity:1}
      .falling{animation:none}
    }
  </style>
</head>
<body>
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>
  <div class="blob b4"></div>

  <h1>点一下就来祝福～</h1>
  <button id="startBtn">开启祝福</button>

  <script>
  (function(){
    'use strict';
    const NAME='SJL';
    const COLORS=['#ffc0cb','#ffb6c1','#ff69b4','#ff1493','#db7093','#c71585','#ffa07a','#ff7f50','#ffa500','#ffd166','#b5e48c','#6ee7b7','#9bf6ff','#a0c4ff','#bdb2ff','#ffadad','#ffd6a5','#fdffb6','#caffbf','#9bf6ff','#a0e7e5','#b2f7ef','#c6d0f5','#f4b6c2','#ffd1dc'];
    const BLESSINGS=[
      '{name}，祝你万事如意！','愿你天天开心，{name}！','{name}，前程似锦！','祝你幸福快乐，{name}！','{name}，心想事成！','愿你平安健康，{name}！','{name}，好运连连！','祝你笑口常开，{name}！','{name}，美梦成真！','愿你事事顺利，{name}！','{name}，所求皆如愿！','好运常伴你左右，{name}！','{name}，前路有光！','美好如约而至，{name}！'
    ];
    const personalize = t => t.replace(/\{name\}/g, NAME);
    const pick = arr => arr[Math.floor(Math.random()*arr.length)];

    // 移动端轻量随机渐变
    function randomCardBG(){
      const c1=pick(COLORS), c2=pick(COLORS);
      return 'linear-gradient(135deg,'+c1+','+c2+')';
    }

    function createPopup(x,y,life){
      const vp = (window.visualViewport||{width:window.innerWidth, height:window.innerHeight});
      const w = vp.width, h = vp.height;
      const el=document.createElement('div');
      el.className='blessing-popup';
      el.style.background = randomCardBG();
      el.textContent = personalize(pick(BLESSINGS));
      const cw = Math.max(160, Math.min(240, Math.floor(w*0.45)));
      const ch = Math.max(80,  Math.min(110, Math.floor(w*0.22)));
      let left = (typeof x==='number')?x:Math.floor(Math.random()*(w-cw));
      let top  = (typeof y==='number')?y:Math.floor(Math.random()*(h-ch));
      left = Math.max(0, Math.min(left, w - cw));
      top  = Math.max(0, Math.min(top , h - ch));
      el.style.left=left+'px';
      el.style.top =top +'px';
      document.body.appendChild(el);
      if(life===-1) return;
      setTimeout(()=>{ el.style.opacity='0'; el.style.transform='scale(.88)'; el.style.transition='all .4s ease'; setTimeout(()=> el.remove(), 420); }, (typeof life==='number'?life:3000));
    }

    // 心形围字（驻留） — 适配小屏，点位略加密
    function heartPositions(n){
      const vp = (window.visualViewport||{width:window.innerWidth, height:window.innerHeight});
      const W = vp.width, H = vp.height;
      const pts=[];
      const cw = Math.max(160, Math.min(240, Math.floor(W*0.45)));
      const ch = Math.max(80,  Math.min(110, Math.floor(W*0.22)));
      const margin = 12;
      const scaleX = (W - cw - 2*margin) / 32; // heart x extent ~ [-16,16]
      const scaleY = (H - ch - 2*margin) / 34; // heart y total span ~ 34
      const scale = Math.max(6, Math.min(scaleX, scaleY)) * 0.95;
      const cx = (W - cw)/2;
      const cy = (H - ch)/2;
      for(let i=0;i<n;i++){
        const t=Math.PI*2*(i/n);
        const x=16*Math.sin(t)**3;
        const y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
        const px = cx + x*scale;
        const py = cy - y*scale;
        pts.push([px, py]);
      }
      return pts;
    }
      return pts;
    }
    function startHeart(){
      // 改为：随机弹窗爆发（无爱心围字）
      const vp = (window.visualViewport||{width:window.innerWidth, height:window.innerHeight});
      const area = vp.width * vp.height;
      const count = Math.max(80, Math.min(200, Math.floor(area/10000))); // 依屏幕面积自适应数量
      const gap = 28; // 每个弹窗间隔（毫秒）
      for(let i=0;i<count;i++){
        setTimeout(()=> createPopup(undefined, undefined, 6000 + Math.floor(Math.random()*3000)), i*gap);
      }
    }

    // 飘落弹幕（轻量，移动端上限更低）
    let barrageTimer=null; const FALLING_LIMIT=110;
    function spawnFalling(){
      const s=document.createElement('span'); s.className='falling';
      s.textContent='❤ '+personalize(pick(BLESSINGS));
      s.style.left=Math.floor(Math.random()*(( (window.visualViewport?window.visualViewport.width:window.innerWidth) - 120 )))+'px';
      s.style.color=pick(COLORS);
      s.style.animationDuration=(7+Math.random()*5)+'s';
      document.body.appendChild(s);
      s.addEventListener('animationend', ()=> s.remove(), {passive:true});
    }
    function startBarrage(){
      if(barrageTimer) return;
      barrageTimer = setInterval(()=>{
        if(document.querySelectorAll('.falling').length < FALLING_LIMIT){ for(let i=0;i<2;i++) spawnFalling(); }
      }, 750);
    }

    // 一键开启（按钮保留“开启祝福”文案）
    let started=false;
    const startBtn = document.getElementById('startBtn');
    const onStart = ()=>{
      if(started) return;
      started=true; startBtn.disabled=true;
      if(navigator.vibrate) try{ navigator.vibrate(15); }catch(e){}
      startHeart(); startBarrage();
    };
    startBtn.addEventListener('click', onStart, {passive:true});
    startBtn.addEventListener('touchstart', onStart, {passive:true});

    // 移动端隐藏清屏：长按空白处 800ms 清屏并可重新开始
    let pressTimer=null; let pressTarget=null;
    function clearAll(){
      document.querySelectorAll('.blessing-popup,.falling').forEach(n=> n.remove());
      if(barrageTimer){ clearInterval(barrageTimer); barrageTimer=null; }
      started=false; startBtn.disabled=false;
    }
    const root=document.body;
    root.addEventListener('touchstart', (e)=>{
      if(e.target===startBtn) return; // 不拦截按钮
      pressTarget=e.target;
      pressTimer=setTimeout(clearAll, 800);
    }, {passive:true});
    root.addEventListener('touchend', ()=>{ if(pressTimer){ clearTimeout(pressTimer); pressTimer=null; } }, {passive:true});
    root.addEventListener('touchmove', ()=>{ if(pressTimer){ clearTimeout(pressTimer); pressTimer=null; } }, {passive:true});
  })();
  </script>
</body>
</html>
